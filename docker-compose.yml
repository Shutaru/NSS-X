# NSS X - National Spatial Strategy Dashboard
# Docker Compose Configuration

services:
  # Main Streamlit Dashboard
  nss-dashboard:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nss-x-dashboard
    restart: unless-stopped
    ports:
      - "8501:8501"
    environment:
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_HEADLESS=true
      - PYTHONPATH=/app
    volumes:
      # Persist data directories
      - ./01_data:/app/01_data:ro
      - ./02_analytics:/app/02_analytics
      - ./03_scenarios:/app/03_scenarios
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - nss-network

  # Ngrok Tunnel for Public Access
  ngrok:
    image: ngrok/ngrok:latest
    container_name: nss-x-ngrok
    restart: unless-stopped
    command:
      - "http"
      - "--url=nss-x.ngrok.dev"
      - "nss-dashboard:8501"
    environment:
      - NGROK_AUTHTOKEN=2s5J3E5Qw4zM1jmkFBbXeuapQBu_6tcRjQPm9XY73bYciBFPi
    depends_on:
      nss-dashboard:
        condition: service_healthy
    networks:
      - nss-network

networks:
  nss-network:
    driver: bridge
